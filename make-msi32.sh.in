#!/bin/bash

SOURCEDIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
TMPDIR=`mktemp -d -p "/tmp"`

cp createmsi.py $TMPDIR/
cp LICENSE $TMPDIR/License.rtf
cp GSharpKit.json $TMPDIR/

# Install to staging
TMP="$TMPDIR/tmp"
DIR="$TMPDIR/framework"

mkdir -p $TMPDIR/tmp/usr/i686-w64-mingw32/sys-root/mingw

sh make-msi-install.sh /usr/i686-w64-mingw32/sys-root/mingw $TMP/usr/i686-w64-mingw32/sys-root/mingw x86

mv $TMP/usr/i686-w64-mingw32/sys-root/mingw $DIR

pushd $TMPDIR
python createmsi.py GSharpKit.json
cp GSharpKit-@VERSION@-32.msi $SOURCEDIR/GSharpKit-@VERSION@-x86.msi
popd

#mv XMedicus@DEMO@-@VERSION@-x86.msi XMedicus@DEMO@-@VERSION@-x86.msi.unsigned
#osslsigncode sign -pkcs12 xmedicus.p12 -pass xcare -n "XMedicus@DEMO@" -i https://www.xmedicus.com -t http://time.certum.pl -in XMedicus@DEMO@-@VERSION@-x86.msi.unsigned -out XMedicus@DEMO@-@VERSION@-x86.msi && rm XMedicus@DEMO@-@VERSION@-x86.msi.unsigned

